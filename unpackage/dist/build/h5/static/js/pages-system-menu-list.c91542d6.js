(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-system-menu-list"],{"38cf":function(n,t,i){var e=i("23e7"),a=i("1148");e({target:"String",proto:!0},{repeat:a})},"3e9d":function(n,t,i){"use strict";var e=i("9b0c"),a=i.n(e);a.a},"5ac5":function(n,t,i){"use strict";(function(n){var e=i("4ea4");i("7db0"),i("4160"),i("d3b7"),i("38cf"),i("159b"),i("ddb0"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a=e(i("5530")),u=i("2f62"),s=[];function r(n,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;n.title=(i?"　".repeat(i)+"|-":"")+n.name,t.push(n),n.children&&c(n.children,t,i+1)}function c(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return n.forEach((function(n){return r(n,t,i)})),t}var o={data:function(){return{loading:!0,menus:[],errMsg:"",currentTab:"menus",selectedPluginMenuIndexs:[]}},computed:{pluginMenus:function(){var n=[];if(!this.$hasRole("admin"))return n;var t=this.menus;return t.length?(s.forEach((function(i){t.find((function(n){return n.menu_id===i.menu_id}))||n.push(i)})),n):n}},watch:{pluginMenus:function(n){n.length||(this.currentTab="menus")}},onLoad:function(){this.loadData()},methods:(0,a.default)((0,a.default)({},(0,u.mapActions)({init:"app/init"})),{},{switchTab:function(n){this.currentTab=n},loadData:function(){var n=this;this.loading=!0,this.$request("system/menu/list",{},{showModal:!1}).then((function(t){n.menus=c(t)})).catch((function(t){n.errMsg=t.message})).finally((function(){n.loading=!1}))},navigateTo:function(n,t){var i=this;uni.navigateTo({url:n,events:{refreshData:function(){i.loadData(t)}}})},confirmDelete:function(n){var t=this,i="是否删除该菜单？";this.menus.find((function(t){return t.parent_id===n.menu_id}))&&(i="是否删除该菜单及其所有子菜单？"),uni.showModal({title:"提示",content:i,success:function(i){i.confirm&&(uni.showLoading({mask:!0}),t.$request("system/menu/delete",{id:n._id}).then((function(){t.init(),t.loadData()})).finally((function(){uni.hideLoading()})))}})},pluginMenuSelectChange:function(n){this.selectedPluginMenuIndexs=n.detail.index},addPluginMenus:function(t){var i=this;if(!this.selectedPluginMenuIndexs.length)return uni.showModal({title:"提示",content:"请选择要添加的菜单！",showCancel:!1});var e=this.pluginMenus,a=[];this.selectedPluginMenuIndexs.forEach((function(n){var t=e[n];if(t){var i=JSON.parse(JSON.stringify(t));delete i.json,a.push(i)}})),uni.showModal({title:"提示",content:"您确认要添加已选中的菜单吗？",success:function(t){if(t.confirm){uni.showLoading({mask:!0});var u=a.length===e.length;n.database().collection("opendb-admin-menus").add(a).then((function(n){i.init(),uni.showModal({title:"提示",content:"添加菜单成功！",showCancel:!1,success:function(){i.$refs.pluginMenusTable.clearSelection(),u&&(i.currentTab="menus"),i.loadData()}})})).catch((function(n){uni.showModal({title:"提示",content:n.message,showCancel:!1})})).finally((function(){uni.hideLoading()}))}}})}})};t.default=o}).call(this,i("a9ff")["default"])},"5f3d":function(n,t,i){"use strict";i.d(t,"b",(function(){return a})),i.d(t,"c",(function(){return u})),i.d(t,"a",(function(){return e}));var e={uniBadge:i("df02").default,uniTable:i("237e").default,uniTr:i("0d2d").default,uniTh:i("ae12").default,uniTd:i("bff5").default},a=function(){var n=this,t=n.$createElement,i=n._self._c||t;return i("v-uni-view",[i("v-uni-view",{staticClass:"uni-tabs__header"},[i("v-uni-view",{staticClass:"uni-tabs__nav-wrap"},[i("v-uni-view",{staticClass:"uni-tabs__nav-scroll"},[i("v-uni-view",{staticClass:"uni-tabs__nav"},[i("v-uni-view",{staticClass:"uni-tabs__item",class:{"is-active":"menus"===n.currentTab},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.switchTab("menus")}}},[n._v("菜单管理")]),n.pluginMenus.length?i("v-uni-view",{staticClass:"uni-tabs__item",class:{"is-active":"pluginMenus"===n.currentTab},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.switchTab("pluginMenus")}}},[n._v("待添加菜单"),i("uni-badge",{staticClass:"menu-badge",attrs:{text:n.pluginMenus.length,type:"error"}})],1):n._e()],1)],1)],1)],1),i("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:"menus"===n.currentTab,expression:"currentTab==='menus'"}]},[i("v-uni-view",{staticClass:"uni-header",staticStyle:{"border-bottom":"0","margin-bottom":"-15px"}},[i("v-uni-view",{staticClass:"uni-group"},[i("v-uni-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.navigateTo("./add")}}},[n._v("新增一级菜单")])],1),i("v-uni-view",{staticClass:"uni-group"})],1),i("v-uni-view",{staticClass:"uni-container"},[i("uni-table",{attrs:{loading:n.loading,emptyText:n.errMsg||"没有更多数据",border:!0,stripe:!0}},[i("uni-tr",[i("uni-th",{attrs:{width:"80",align:"center"}},[n._v("排序")]),i("uni-th",{attrs:{width:"200",align:"center"}},[n._v("名称")]),i("uni-th",{attrs:{width:"200",align:"center"}},[n._v("标识")]),i("uni-th",{attrs:{align:"center"}},[n._v("URL")]),i("uni-th",{attrs:{width:"100",align:"center"}},[n._v("是否启用")]),i("uni-th",{attrs:{width:"160",align:"center"}},[n._v("操作")])],1),n._l(n.menus,(function(t,e){return i("uni-tr",{key:e},[i("uni-td",{attrs:{align:"center"}},[n._v(n._s(t.sort))]),i("uni-td",[n._v(n._s(t.title))]),i("uni-td",[n._v(n._s(t.menu_id))]),i("uni-td",[n._v(n._s(t.url))]),i("uni-td",{class:{"menu-disable":!t.enable},attrs:{align:"center"}},[n._v(n._s(t.enable?"已启用":"未启用"))]),i("uni-td",{attrs:{align:"center"}},[i("v-uni-view",{staticClass:"uni-group"},[t.url?n._e():i("v-uni-button",{staticClass:"uni-button",attrs:{size:"mini",type:"primary"},on:{click:function(i){arguments[0]=i=n.$handleEvent(i),n.navigateTo("./add?parent_id="+t.menu_id,!1)}}},[n._v("子菜单")]),i("v-uni-button",{staticClass:"uni-button",attrs:{size:"mini",type:"primary"},on:{click:function(i){arguments[0]=i=n.$handleEvent(i),n.navigateTo("./edit?id="+t._id,!1)}}},[n._v("修   改")]),i("v-uni-button",{staticClass:"uni-button",style:{visibility:"system_menu"===t.menu_id||"system_management"===t.menu_id?"hidden":"initial"},attrs:{size:"mini",type:"warn"},on:{click:function(i){arguments[0]=i=n.$handleEvent(i),n.confirmDelete(t)}}},[n._v("删   除")])],1)],1)],1)}))],2)],1)],1),i("v-uni-view",{directives:[{name:"show",rawName:"v-show",value:"pluginMenus"===n.currentTab,expression:"currentTab==='pluginMenus'"}]},[i("v-uni-view",{staticClass:"uni-header",staticStyle:{"border-bottom":"0","margin-bottom":"-15px"}},[i("v-uni-view",{staticClass:"uni-group"},[i("v-uni-button",{staticStyle:{width:"130px"},attrs:{size:"mini",type:"primary"},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.addPluginMenus.apply(void 0,arguments)}}},[n._v("添加选中的菜单")])],1),i("v-uni-view",{staticClass:"uni-group"})],1),i("v-uni-view",{staticClass:"uni-container"},[i("uni-table",{ref:"pluginMenusTable",attrs:{type:"selection",border:!0,stripe:!0},on:{"selection-change":function(t){arguments[0]=t=n.$handleEvent(t),n.pluginMenuSelectChange.apply(void 0,arguments)}}},[i("uni-tr",[i("uni-th",{attrs:{align:"center"}},[n._v("名称（标识）")]),i("uni-th",{attrs:{align:"center"}},[n._v("URL")]),i("uni-th",{attrs:{align:"center"}},[n._v("插件菜单 json 文件")])],1),n._l(n.pluginMenus,(function(t,e){return i("uni-tr",{key:e},[i("uni-td",[n._v(n._s(t.name)+"（"+n._s(t.menu_id)+"）")]),i("uni-td",[n._v(n._s(t.url))]),i("uni-td",[n._v(n._s(t.json))])],1)}))],2),i("v-uni-view",{staticClass:"uni-sub-title",staticStyle:{"margin-top":"15px"}},[n._v("以上待添加菜单来自于三方插件，添加后，将显示在菜单管理中，若不希望显示在上述表格中时，可手动删除项目中对应的`插件id-menu.json`文件。")])],1)],1)],1)},u=[]},"9b0c":function(n,t,i){var e=i("b150");"string"===typeof e&&(e=[[n.i,e,""]]),e.locals&&(n.exports=e.locals);var a=i("4f06").default;a("898671dc",e,!0,{sourceMap:!1,shadowMode:!1})},b150:function(n,t,i){var e=i("24fb");t=e(!1),t.push([n.i,"\n.menu-disable[data-v-56925f83]{color:red}.menu-badge[data-v-56925f83]{position:absolute;top:0;right:5px}",""]),n.exports=t},beae:function(n,t,i){"use strict";i.r(t);var e=i("5f3d"),a=i("cc00");for(var u in a)"default"!==u&&function(n){i.d(t,n,(function(){return a[n]}))}(u);i("3e9d");var s,r=i("f0c5"),c=Object(r["a"])(a["default"],e["b"],e["c"],!1,null,"56925f83",null,!1,e["a"],s);t["default"]=c.exports},cc00:function(n,t,i){"use strict";i.r(t);var e=i("5ac5"),a=i.n(e);for(var u in e)"default"!==u&&function(n){i.d(t,n,(function(){return e[n]}))}(u);t["default"]=a.a}}]);
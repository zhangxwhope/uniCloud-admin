(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-system-user-edit"],{"17ff":function(t,e,a){"use strict";var s=a("3e9b"),n=a.n(s);n.a},3592:function(t,e,a){"use strict";(function(t){var s=a("4ea4");a("caad"),a("c975"),a("d81d"),a("a9e3"),a("d3b7"),a("2532"),Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=s(a("5530")),r=s(a("7ded")),o=t.database(),i=(o.command,"uni-id-users");function l(t){var e={};for(var a in r.default)t.includes(a)&&(e[a]=r.default[a]);return e}var u={data:function(){return{showPassword:!1,formData:{username:"",password:"",role:[],mobile:"",email:"",status:!1},rules:(0,n.default)((0,n.default)({},l(["username","password","role","mobile","email"])),{},{status:{rules:[{format:"bool"}]}}),roles:[]}},onLoad:function(t){var e=t.id;this.formDataId=e,this.getDetail(e),this.loadroles()},methods:{trigger:function(){this.showPassword=!this.showPassword},submitForm:function(t){this.$refs.form.submit()},submit:function(t){var e=this,a=t.detail,s=a.value,n=a.errors;if(!n){uni.showLoading({title:"修改中...",mask:!0}),"boolean"===typeof s.status&&(s.status=Number(!s.status));var r={uid:this.formDataId,password:s.password};delete s.password,o.collection(i).where({_id:this.formDataId}).update(s).then((function(t){e.showPassword&&r.password&&e.resetPWd(r),uni.showToast({title:"修改成功"}),e.getOpenerEventChannel().emit("refreshData"),setTimeout((function(){return uni.navigateBack()}),500)})).catch((function(t){uni.showModal({content:t.message||"请求服务失败",showCancel:!1})})).finally((function(){uni.hideLoading()}))}},resetPWd:function(t){this.$request("system/user/resetPwd",t).then().catch((function(t){uni.showModal({content:t.message||"请求服务失败",showCancel:!1})})).finally()},getDetail:function(t){var e=this;uni.showLoading({mask:!0}),o.collection(i).doc(t).field("username,role,mobile,email,status").get().then((function(t){var a=t.result.data[0];a&&(void 0===a.status&&(a.status=!0),0===a.status&&(a.status=!0),1===a.status&&(a.status=!1),e.formData=a)})).catch((function(t){uni.showModal({content:t.message||"请求服务失败",showCancel:!1})})).finally((function(){uni.hideLoading()}))},loadroles:function(){var t=this;o.collection("uni-id-roles").limit(500).get().then((function(e){var a=[];t.roles=e.result.data.map((function(t){return a.push(t.role_id),{value:t.role_id,text:t.role_name}})),-1===a.indexOf("admin")&&t.roles.unshift({value:"admin",text:"超级管理员"})})).catch((function(t){uni.showModal({title:"提示",content:t.message,showCancel:!1})}))},parseUserStatus:function(t){return 0===t?"启用":1===t?"禁用":2===t?"审核中":3===t?"审核拒绝":"启用"}}};e.default=u}).call(this,a("a9ff")["default"])},"3e26":function(t,e,a){var s=a("24fb");e=s(!1),e.push([t.i,".reset-password-btn[data-v-1e091267]{\n\t/* height: 100%; */line-height:36px;color:#007aff;text-decoration:underline;cursor:pointer}.cancel-reset-password-btn[data-v-1e091267]{color:#007aff;padding-right:10px;cursor:pointer}",""]),t.exports=e},"3e9b":function(t,e,a){var s=a("3e26");"string"===typeof s&&(s=[[t.i,s,""]]),s.locals&&(t.exports=s.locals);var n=a("4f06").default;n("6621cd65",s,!0,{sourceMap:!1,shadowMode:!1})},"7ded":function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var s={username:{rules:[{required:!0,errorMessage:"{label}必填"},{format:"string"},{minLength:2}],label:"用户名"},password:{rules:[{required:!0,errorMessage:"{label}必填"},{format:"string"},{minLength:6}],label:"密码"},mobile:{rules:[{format:"string"},{pattern:"^\\+?[0-9-]{3,20}$"}],label:"手机号"},email:{rules:[{format:"string"},{format:"email"}],label:"邮箱"},role:{rules:[{format:"array"}]}};e.default=s},"8b4b":function(t,e,a){"use strict";a.r(e);var s=a("3592"),n=a.n(s);for(var r in s)"default"!==r&&function(t){a.d(e,t,(function(){return s[t]}))}(r);e["default"]=n.a},b8d1:function(t,e,a){"use strict";a.d(e,"b",(function(){return n})),a.d(e,"c",(function(){return r})),a.d(e,"a",(function(){return s}));var s={uniForms:a("7351").default,uniFormsItem:a("4f13").default,uniEasyinput:a("a786").default,uniDataCheckbox:a("39b2").default},n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-uni-view",{staticClass:"uni-container"},[a("uni-forms",{ref:"form",attrs:{rules:t.rules,validateTrigger:"bind"},on:{submit:function(e){arguments[0]=e=t.$handleEvent(e),t.submit.apply(void 0,arguments)}},model:{value:t.formData,callback:function(e){t.formData=e},expression:"formData"}},[a("uni-forms-item",{attrs:{name:"username",label:"用户名",required:!0}},[a("uni-easyinput",{attrs:{clearable:!1,placeholder:"请输入用户名"},model:{value:t.formData.username,callback:function(e){t.$set(t.formData,"username",e)},expression:"formData.username"}})],1),a("uni-forms-item",{attrs:{name:t.showPassword?"password":"",label:"重置密码"}},[a("span",{directives:[{name:"show",rawName:"v-show",value:!t.showPassword,expression:"!showPassword"}],staticClass:"reset-password-btn",on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.trigger.apply(void 0,arguments)}}},[t._v("点击重置密码")]),a("uni-easyinput",{directives:[{name:"show",rawName:"v-show",value:t.showPassword,expression:"showPassword"}],attrs:{clearable:!1,placeholder:"请输入重置密码"},model:{value:t.formData.password,callback:function(e){t.$set(t.formData,"password",e)},expression:"formData.password"}},[a("v-uni-view",{staticClass:"cancel-reset-password-btn",attrs:{slot:"right"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.trigger.apply(void 0,arguments)}},slot:"right"},[t._v("取消")])],1)],1),a("uni-forms-item",{attrs:{name:"role",label:"角色列表"}},[a("uni-data-checkbox",{attrs:{multiple:!0,localdata:t.roles},model:{value:t.formData.role,callback:function(e){t.$set(t.formData,"role",e)},expression:"formData.role"}})],1),a("uni-forms-item",{attrs:{name:"mobile",label:"手机号"}},[a("uni-easyinput",{attrs:{clearable:!1,placeholder:"请输入手机号"},model:{value:t.formData.mobile,callback:function(e){t.$set(t.formData,"mobile",e)},expression:"formData.mobile"}})],1),a("uni-forms-item",{attrs:{name:"email",label:"邮箱"}},[a("uni-easyinput",{attrs:{clearable:!1,placeholder:"请输入邮箱"},model:{value:t.formData.email,callback:function(e){t.$set(t.formData,"email",e)},expression:"formData.email"}})],1),a("uni-forms-item",{attrs:{name:"status",label:"用户状态"}},[Number(t.formData.status)<2?a("v-uni-switch",{attrs:{checked:t.formData.status},on:{change:function(e){arguments[0]=e=t.$handleEvent(e),t.binddata("status",e.detail.value)}}}):a("v-uni-view",{staticClass:"uni-form-item-empty"},[t._v(t._s(t.parseUserStatus(t.formData.status)))])],1),a("v-uni-view",{staticClass:"uni-button-group"},[a("v-uni-button",{staticClass:"uni-button",staticStyle:{width:"100px"},attrs:{type:"primary"},on:{click:function(e){arguments[0]=e=t.$handleEvent(e),t.submitForm.apply(void 0,arguments)}}},[t._v("提交")]),a("v-uni-navigator",{staticStyle:{"margin-left":"15px"},attrs:{"open-type":"navigateBack"}},[a("v-uni-button",{staticClass:"uni-button",staticStyle:{width:"100px"}},[t._v("返回")])],1)],1)],1)],1)},r=[]},bc83:function(t,e,a){"use strict";a.r(e);var s=a("b8d1"),n=a("8b4b");for(var r in n)"default"!==r&&function(t){a.d(e,t,(function(){return n[t]}))}(r);a("17ff");var o,i=a("f0c5"),l=Object(i["a"])(n["default"],s["b"],s["c"],!1,null,"1e091267",null,!1,s["a"],o);e["default"]=l.exports}}]);